(function(a){'use strict';a.HSCore.components.HSCountdown={_baseConfig:{yearsElSelector:'.years',monthsElSelector:'.months',daysElSelector:'.days',hoursElSelector:'.hours',minutesElSelector:'.minutes',secondsElSelector:'.seconds',circles:!1,wrpClass:'wrpClass',textClass:'textClass',valueStrokeClass:'valueStrokeClass',maxValueStrokeClass:'maxValueStrokeClass',styleWrapper:'styleWrapper',styleText:'styleText'},pageCollection:a(),_circlesIds:[0],init:function(b,c){if(this.collection=b&&a(b).length?a(b):a(),!a(b).length)return;return this.config=c&&a.isPlainObject(c)?a.extend({},this._baseConfig,c):this._baseConfig,this.config.itemSelector=b,this.initCountdowns(),this.pageCollection},initCountdowns:function(){var b=this;this.collection.each(function(f,e){var c=a(e),d={endDate:c.data('end-date')?new Date(c.data('end-date')):new Date,startDate:c.data('start-date')?new Date(c.data('start-date')):new Date,yearsEl:c.find(b.config.yearsElSelector),yearsFormat:c.data('years-format'),monthsEl:c.find(b.config.monthsElSelector),monthsFormat:c.data('months-format'),daysEl:c.find(b.config.daysElSelector),daysFormat:c.data('days-format'),hoursEl:c.find(b.config.hoursElSelector),hoursFormat:c.data('hours-format'),minutesEl:c.find(b.config.minutesElSelector),minutesFormat:c.data('minutes-format'),secondsEl:c.find(b.config.secondsElSelector),secondsFormat:c.data('seconds-format')};b.config.circles&&c.data('start-date')?b._initPiesImplementation(c,d):b._initBaseImplementation(c,d),b.pageCollection=b.pageCollection.add(c)})},_initBaseImplementation:function(b,a){b.countdown(a.endDate,function(b){a.yearsEl.length&&a.yearsEl.text(b.strftime(a.yearsFormat)),a.monthsEl.length&&a.monthsEl.text(b.strftime(a.monthsFormat)),a.daysEl.length&&a.daysEl.text(b.strftime(a.daysFormat)),a.hoursEl.length&&a.hoursEl.text(b.strftime(a.hoursFormat)),a.minutesEl.length&&a.minutesEl.text(b.strftime(a.minutesFormat)),a.secondsEl.length&&a.secondsEl.text(b.strftime(a.secondsFormat))})},_initPiesImplementation:function(b,a){var c=this,e,d=24*60*60*1e3;a.yearsEl.length&&c._preparePieItem(a.yearsEl,{maxValue:a.endDate.getFullYear()-a.startDate.getFullYear(),radius:b.data('circles-radius'),width:b.data('circles-stroke-width'),'fg-color':b.data('circles-fg-color'),'bg-color':b.data('circles-bg-color'),'additional-text':b.data('circles-additional-text'),'font-size':b.data('circles-font-size')}),a.monthsEl.length&&c._preparePieItem(a.monthsEl,{maxValue:Math.round(Math.abs((a.endDate.getTime()-a.startDate.getTime())/d))/12,radius:b.data('circles-radius'),width:b.data('circles-stroke-width'),'fg-color':b.data('circles-fg-color'),'bg-color':b.data('circles-bg-color'),'additional-text':b.data('circles-additional-text'),'font-size':b.data('circles-font-size')}),a.daysEl.length&&c._preparePieItem(a.daysEl,{maxValue:c._getDaysMaxValByFormat(a.daysFormat,a.startDate,a.endDate),radius:b.data('circles-radius'),width:b.data('circles-stroke-width'),'fg-color':b.data('circles-fg-color'),'bg-color':b.data('circles-bg-color'),'additional-text':b.data('circles-additional-text'),'font-size':b.data('circles-font-size')}),a.hoursEl.length&&c._preparePieItem(a.hoursEl,{maxValue:60,radius:b.data('circles-radius'),width:b.data('circles-stroke-width'),'fg-color':b.data('circles-fg-color'),'bg-color':b.data('circles-bg-color'),'additional-text':b.data('circles-additional-text'),'font-size':b.data('circles-font-size')}),a.minutesEl.length&&c._preparePieItem(a.minutesEl,{maxValue:60,radius:b.data('circles-radius'),width:b.data('circles-stroke-width'),'fg-color':b.data('circles-fg-color'),'bg-color':b.data('circles-bg-color'),'additional-text':b.data('circles-additional-text'),'font-size':b.data('circles-font-size')}),a.secondsEl.length&&c._preparePieItem(a.secondsEl,{maxValue:60,radius:b.data('circles-radius'),width:b.data('circles-stroke-width'),'fg-color':b.data('circles-fg-color'),'bg-color':b.data('circles-bg-color'),'additional-text':b.data('circles-additional-text'),'font-size':b.data('circles-font-size')}),b.countdown(a.endDate,function(b){a.yearsEl.length&&a.yearsEl.data('circle').update(b.strftime(a.yearsFormat)),a.monthsEl.length&&a.monthsEl.data('circle').update(b.strftime(a.monthsFormat)),a.daysEl.length&&a.daysEl.data('circle').update(b.strftime(a.daysFormat)),a.hoursEl.length&&a.hoursEl.data('circle').update(b.strftime(a.hoursFormat)),a.minutesEl.length&&a.minutesEl.data('circle').update(b.strftime(a.minutesFormat)),a.secondsEl.length&&a.secondsEl.data('circle').update(b.strftime(a.secondsFormat))})},_preparePieItem:function(c,b){var a=this,d=a._circlesIds[a._circlesIds.length-1]+1;a._circlesIds.push(d),c.attr('id','hs-countdown-element-'+d),c.data('circle',Circles.create({id:'hs-countdown-element-'+d,radius:b.radius||80,value:0,maxValue:b.maxValue||100,width:b.width||10,text:function(a){return a+(b['additional-text']||'')},colors:[b['bg-color']||'#eeeeee',b['fg-color']||'#72c02c'],duration:0,wrpClass:a.config.wrpClass,textClass:a.config.textClass,valueStrokeClass:a.config.valueStrokeClass,maxValueStrokeClass:a.config.maxValueStrokeClass,styleWrapper:a.config.styleWrapper,styleText:a.config.styleText})),b['font-size']&&c.find('.'+a.config.textClass).css('font-size',b['font-size']+'px')},_getDaysMaxValByFormat:function(a,b,c){var d=24*60*60*1e3;switch(a){case'%D':return Math.round(Math.abs((c.getTime()-b.getTime())/d));break;default:return 31}}}})(jQuery)